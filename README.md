# みなととあらがの成長記録

**誇り高き日本を作ろう - 赤ちゃん「みなと」の成長と「あらが」の日常を記録する視覚日記**

## 📖 プロジェクト概要

- **プロジェクト名**: みなととあらがの成長記録
- **みなと誕生日**: 2025年11月7日
- **あらが誕生日**: 1998年5月9日
- **コンセプト**: 赤ちゃん「みなと」の成長記録と、「あらが」の日常を同じタイムラインで記録・対比する視覚日記アプリ
- **デザインテーマ**: 1940年代の日本プロパガンダポスター風レトロデザイン

## 🌐 アクセスURL

- **本番環境**: https://d2fd76ab.baby-diary.pages.dev
- **GitHubリポジトリ**: https://github.com/fhaoghaogjapw-a12390290/baby-diary
- **TOPページ**: `/` (パスワード: `minato1107`)
- **日記閲覧ページ**: `/view`
- **投稿ページ**: `/post`

## ✨ 主な機能

### 1. TOPページ（物語の始まり）
- **パスワード認証**: `minato1107`で入室
- **みなととあらがの日齢をリアルタイム表示**
  - みなと生後X日目
  - あらが生後X日目
  - 素数の日は「🎊 素数記念日 🎊」と表示
- **最新3件の記録をカード形式で表示**（あらが→みなとの順）
- **記録カードクリックでモーダル表示**
  - 画像全画面表示
  - 編集ボタン付き

### 2. 投稿インターフェース（今日の記録を投稿する）
- **2つのアカウント**（みなと、あらが）で個別選択
- **日付選択**（過去・未来の日付にも投稿可能、誕生日より前は不可）
- **自動日齢計算と表示**
  - みなと生後X日目
  - あらが生後X日目
  - 両方の素数記念日を表示
- **画像アップロード**（最大5MB）とプレビュー機能
- **見出しテキスト入力**（最大50文字）
- **既存記録の編集機能**

### 3. 閲覧ページ（タイムライン・ビューワー）
- **カレンダーインターフェース**
  - **現在表示中の日付のみアンバー色でハイライト**
  - 月次ナビゲーション（前の月/次の月）
- **日齢ワープ検索機能**
  - 「みなとX日目」で直接ジャンプ
- **記録表示**
  - 選択日の日付を日本語形式で表示
  - **みなと生後X日目とあらが生後X日目を両方表示**
  - **各人の素数記念日を表示**
  - 2人（あらが、みなと）の記録を並列表示
  - **前の日/次の日ナビゲーション**（記録の有無に関わらず移動可能、未来日付もOK）
- **記録カードクリックでモーダル表示**
  - 各人の日齢を正しく表示
  - 編集ボタン付き

### 4. 日齢計算システム
- **みなとの誕生日**: 2025年11月7日
  - 日齢1 = 2025年11月7日（誕生日）
  - 日齢N = 誕生日 + (N-1)日
- **あらがの誕生日**: 1998年5月9日
  - 日齢1 = 1998年5月9日（誕生日）
  - 日齢N = 誕生日 + (N-1)日
- **素数記念日**: 各人の日齢が素数の日は特別表示

### 5. デザイン特徴
- **レトロ1940年代風**
  - ダークティール背景 (#2c5a5a)
  - ブラウン枠線 (#8B4513)
  - アンバー紙質 (#FEF3C7)
  - 日の丸モチーフ
- **Noto Serif JP フォント** - 広い文字間隔
- **統一されたUIテーマ**

## 🗄️ データアーキテクチャ

### データベース: Cloudflare D1（SQLite）

#### テーブル構成

**entries テーブル**
```sql
- id: INTEGER PRIMARY KEY
- entry_date: TEXT (YYYY-MM-DD形式)
- day_age: INTEGER (みなとの日齢)
- person: TEXT (minato, araga) ← 2人のみ
- title: TEXT (見出し、最大50文字)
- image_url: TEXT (R2へのパス)
- created_at: DATETIME
- updated_at: DATETIME
- UNIQUE INDEX: (entry_date, person)
```

**表示順序**: あらが → みなと（固定）

### ストレージ: Cloudflare R2
- 画像ファイルの保存
- パス形式: `{entry_date}/{person}/{timestamp}-{filename}`

### データフロー
1. ユーザーが投稿フォームから画像+テキストを送信
2. 画像をR2にアップロード
3. 日齢を自動計算（みなと・あらが両方）
4. D1データベースにメタデータを保存
5. 閲覧時はD1から記録を取得、R2から画像を配信

## 🎯 完了した機能

✅ プロジェクトセットアップ（Hono + Cloudflare Pages）  
✅ D1データベース設計とマイグレーション  
✅ TypeScript型定義とユーティリティ関数  
✅ バックエンドAPI実装（認証、CRUD操作）  
✅ パスワード認証システム（sessionStorage）  
✅ TOPページ（最新記録表示、両方の日齢カウント）  
✅ 投稿インターフェース（画像アップロード、プレビュー）  
✅ 閲覧ページ（カレンダー、記録表示、ナビゲーション）  
✅ 日齢ワープ検索機能  
✅ 素数記念日表示（みなと・あらが両方）  
✅ カレンダー表示（現在の日付のみハイライト）  
✅ 前後日ナビゲーション（未来日付も移動可能）  
✅ モーダル表示（編集ボタン付き）  
✅ 2人構成への変更（りゅうを削除）  
✅ あらがの日齢計算と表示  
✅ レトロデザインテーマ実装  
✅ Cloudflare D1本番データベース設定  
✅ Cloudflare R2画像ストレージ設定  
✅ 本番環境への完全デプロイ  

## 🚧 未実装の機能

- コメント機能
- 統計ダッシュボード
- エクスポート機能（PDF出力）
- 月次/年次アーカイブ機能
- PWA対応（オフラインアクセス）

## 🔧 開発環境

### 技術スタック
- **バックエンド**: Hono v4.0+ + TypeScript
- **フロントエンド**: Vanilla JavaScript + TailwindCSS (CDN)
- **データベース**: Cloudflare D1 (SQLite)
- **ストレージ**: Cloudflare R2
- **ホスティング**: Cloudflare Pages
- **ビルドツール**: Vite v6.4+
- **デプロイツール**: Wrangler v4.46+
- **プロセス管理**: PM2 (開発環境)

### ローカル開発

```bash
# 依存関係のインストール
npm install

# データベースマイグレーション（ローカル）
npm run db:migrate:local

# テストデータ投入
npm run db:seed

# ビルド
npm run build

# 開発サーバー起動（PM2）
fuser -k 3000/tcp 2>/dev/null || true
pm2 start ecosystem.config.cjs

# ログ確認
pm2 logs --nostream

# サーバー停止
pm2 delete webapp
```

### データベース管理

```bash
# ローカルDBリセット
npm run db:reset

# ローカルDBコンソール
npm run db:console:local -- --command="SELECT * FROM entries"

# 本番DBマイグレーション
npm run db:migrate:prod
```

## 📁 プロジェクト構成

```
webapp/
├── src/
│   ├── index.tsx          # メインアプリケーション（Hono routes）
│   ├── types/
│   │   └── index.ts       # TypeScript型定義
│   └── utils/
│       └── date.ts        # 日付・日齢計算関数
├── public/
│   └── static/
│       ├── view.js        # 閲覧ページJS
│       ├── post.js        # 投稿ページJS
│       └── auth.js        # 認証JS
├── migrations/
│   └── 0001_initial_schema.sql  # DBスキーマ
├── seed.sql               # テストデータ
├── wrangler.jsonc         # Cloudflare設定
├── ecosystem.config.cjs   # PM2設定
├── package.json           # 依存関係とスクリプト
└── README.md              # このファイル
```

## 📝 使い方

### 新規ユーザーの場合

1. **TOPページにアクセス**
   - パスワード「minato1107」を入力
   - 現在のみなととあらがの日齢を確認
   - 最新の記録をプレビュー
   - カードクリックで詳細表示

2. **投稿ページで記録を追加**
   - `/post` にアクセス
   - アカウントを選択（みなと or あらが）
   - 日付、見出し、画像を入力して投稿
   - 両方の日齢が自動計算される

3. **閲覧ページで過去を振り返る**
   - `/view` にアクセス
   - カレンダーから日付を選択
   - または「日齢ワープ」で特定の日齢へジャンプ
   - 前後の日ボタンで連続閲覧

### 記録のコンセプト

- **みなと（👶）**: 赤ちゃんの成長記録（授乳、お風呂、初めての○○など）
- **あらが（👴）**: 日常記録（仕事、趣味、日常の出来事）

→ 同じ日に2人の全く異なる時間の流れを対比させることで、人生の多様性と面白さを記録

## 🚀 推奨される次のステップ

1. **本番環境へのデプロイ準備**
   - Cloudflare D1データベースの本番作成
   - R2バケットの作成
   - 環境変数の設定

2. **セキュリティ強化**
   - パスワードハッシュ化
   - CSRF対策
   - 画像アップロードのバリデーション強化

3. **UI/UX改善**
   - モバイル最適化
   - 画像の遅延読み込み
   - ローディング状態の改善

4. **機能追加**
   - コメント機能（相互交流）
   - 月次/年次統計ダッシュボード
   - PDF/画像エクスポート機能

## 📄 ライセンス

このプロジェクトは個人利用を目的としています。

## 👥 作成者

- **開発**: Claude (AI Assistant)
- **企画**: プロジェクトオーナー

---

**最終更新日**: 2025年11月7日  
**デプロイ状態**: ✅ 本番環境で完全稼働中（スマホ最適化済み）  
**バージョン**: 2.4.0 (UI改善版)

## 📋 最近の変更履歴

### 2025-11-07 v2.2.0
- ✅ Cloudflare R2ストレージ有効化
- ✅ R2バケット作成（baby-diary-bucket）
- ✅ wrangler.jsonc にR2設定追加
- ✅ D1 + R2バインディング設定完了
- ✅ 画像アップロード機能が本番環境で動作
- ✅ 完全デプロイ完了

### 2025-11-07 v2.1.0
- ✅ Cloudflare D1本番データベース作成
- ✅ wrangler.jsonc にD1設定追加
- ✅ 本番環境マイグレーション実行
- ✅ Cloudflare Pagesにデプロイ
- ✅ D1バインディング設定完了

### 2025-11-07 v2.4.0
- ✅ TOP画面の日齢をリアルタイム計算に変更（当日日付に自動更新）
- ✅ 記録表示順を「みなと → あらが」に変更
- ✅ カードの色を両方とも青に統一
- ✅ あらがの絵文字を👴に変更

### 2025-11-07 v2.3.0
- ✅ あらがの誕生日を1998年5月9日に変更
- ✅ スマホ対応の改善（レスポンシブデザイン最適化）

### 2025-11-07 v2.0.0
- ✅ 「りゅう」を削除し、2人構成に変更
- ✅ あらがの誕生日を1998年10月1日に設定
- ✅ 「あらが生後X日目」表示を全画面に追加
- ✅ あらがの素数記念日も表記
- ✅ 直近記録のあらがの日付欄を「あらが生後X日目」に変更
- ✅ カレンダーは表示中の日付のみハイライト
- ✅ 未来日付への移動を可能に

### 2025-11-07 v1.5.0
- ✅ カレンダーの色付けロジックを変更（表示日のみハイライト）
- ✅ 全ての「みなとX日目」を「みなと生後X日目」に変更
- ✅ 未来日付への移動制限を解除

### 2025-11-07 v1.0.0
- ✅ 初期バージョンリリース
- ✅ 基本機能実装完了
